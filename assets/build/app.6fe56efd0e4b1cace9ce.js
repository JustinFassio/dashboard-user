(()=>{"use strict";var e,r,t={7:e=>{var r,t="object"==typeof Reflect?Reflect:null,n=t&&"function"==typeof t.apply?t.apply:function(e,r,t){return Function.prototype.apply.call(e,r,t)};r=t&&"function"==typeof t.ownKeys?t.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var o=Number.isNaN||function(e){return e!=e};function a(){a.init.call(this)}e.exports=a,e.exports.once=function(e,r){return new Promise((function(t,n){function o(t){e.removeListener(r,a),n(t)}function a(){"function"==typeof e.removeListener&&e.removeListener("error",o),t([].slice.call(arguments))}p(e,r,a,{once:!0}),"error"!==r&&function(e,r){"function"==typeof e.on&&p(e,"error",r,{once:!0})}(e,o)}))},a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var s=10;function i(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function l(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function d(e,r,t,n){var o,a,s,d;if(i(t),void 0===(a=e._events)?(a=e._events=Object.create(null),e._eventsCount=0):(void 0!==a.newListener&&(e.emit("newListener",r,t.listener?t.listener:t),a=e._events),s=a[r]),void 0===s)s=a[r]=t,++e._eventsCount;else if("function"==typeof s?s=a[r]=n?[t,s]:[s,t]:n?s.unshift(t):s.push(t),(o=l(e))>0&&s.length>o&&!s.warned){s.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(r)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=r,c.count=s.length,d=c,console&&console.warn&&console.warn(d)}return e}function c(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function u(e,r,t){var n={fired:!1,wrapFn:void 0,target:e,type:r,listener:t},o=c.bind(n);return o.listener=t,n.wrapFn=o,o}function h(e,r,t){var n=e._events;if(void 0===n)return[];var o=n[r];return void 0===o?[]:"function"==typeof o?t?[o.listener||o]:[o]:t?function(e){for(var r=new Array(e.length),t=0;t<r.length;++t)r[t]=e[t].listener||e[t];return r}(o):m(o,o.length)}function f(e){var r=this._events;if(void 0!==r){var t=r[e];if("function"==typeof t)return 1;if(void 0!==t)return t.length}return 0}function m(e,r){for(var t=new Array(r),n=0;n<r;++n)t[n]=e[n];return t}function p(e,r,t,n){if("function"==typeof e.on)n.once?e.once(r,t):e.on(r,t);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(r,(function o(a){n.once&&e.removeEventListener(r,o),t(a)}))}}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");s=e}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return l(this)},a.prototype.emit=function(e){for(var r=[],t=1;t<arguments.length;t++)r.push(arguments[t]);var o="error"===e,a=this._events;if(void 0!==a)o=o&&void 0===a.error;else if(!o)return!1;if(o){var s;if(r.length>0&&(s=r[0]),s instanceof Error)throw s;var i=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw i.context=s,i}var l=a[e];if(void 0===l)return!1;if("function"==typeof l)n(l,this,r);else{var d=l.length,c=m(l,d);for(t=0;t<d;++t)n(c[t],this,r)}return!0},a.prototype.addListener=function(e,r){return d(this,e,r,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(e,r){return d(this,e,r,!0)},a.prototype.once=function(e,r){return i(r),this.on(e,u(this,e,r)),this},a.prototype.prependOnceListener=function(e,r){return i(r),this.prependListener(e,u(this,e,r)),this},a.prototype.removeListener=function(e,r){var t,n,o,a,s;if(i(r),void 0===(n=this._events))return this;if(void 0===(t=n[e]))return this;if(t===r||t.listener===r)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,t.listener||r));else if("function"!=typeof t){for(o=-1,a=t.length-1;a>=0;a--)if(t[a]===r||t[a].listener===r){s=t[a].listener,o=a;break}if(o<0)return this;0===o?t.shift():function(e,r){for(;r+1<e.length;r++)e[r]=e[r+1];e.pop()}(t,o),1===t.length&&(n[e]=t[0]),void 0!==n.removeListener&&this.emit("removeListener",e,s||r)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(e){var r,t,n;if(void 0===(t=this._events))return this;if(void 0===t.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==t[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete t[e]),this;if(0===arguments.length){var o,a=Object.keys(t);for(n=0;n<a.length;++n)"removeListener"!==(o=a[n])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(r=t[e]))this.removeListener(e,r);else if(void 0!==r)for(n=r.length-1;n>=0;n--)this.removeListener(e,r[n]);return this},a.prototype.listeners=function(e){return h(this,e,!0)},a.prototype.rawListeners=function(e){return h(this,e,!1)},a.listenerCount=function(e,r){return"function"==typeof e.listenerCount?e.listenerCount(r):f.call(e,r)},a.prototype.listenerCount=f,a.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},20:(e,r,t)=>{var n=t(609),o=Symbol.for("react.element"),a=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,i=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function d(e,r,t){var n,a={},d=null,c=null;for(n in void 0!==t&&(d=""+t),void 0!==r.key&&(d=""+r.key),void 0!==r.ref&&(c=r.ref),r)s.call(r,n)&&!l.hasOwnProperty(n)&&(a[n]=r[n]);if(e&&e.defaultProps)for(n in r=e.defaultProps)void 0===a[n]&&(a[n]=r[n]);return{$$typeof:o,type:e,key:d,ref:c,props:a,_owner:i.current}}r.Fragment=a,r.jsx=d,r.jsxs=d},848:(e,r,t)=>{e.exports=t(20)},57:(e,r,t)=>{t.d(r,{t:()=>s});var n=t(848),o=t(609),a=t.n(o);class s extends a().Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,r){console.error("Error caught by boundary:",e,r),performance.mark("feature-error")}render(){return this.state.hasError?(0,n.jsxs)("div",{className:"feature-error",children:[(0,n.jsx)("h2",{children:"Something went wrong"}),(0,n.jsx)("p",{children:this.state.error?.message||"An unexpected error occurred."}),(0,n.jsx)("button",{onClick:()=>window.location.reload(),children:"Reload Page"})]}):this.props.children}}},813:(e,r,t)=>{t.d(r,{p:()=>a});const n={base:"athlete-dashboard/v1/profile",test:"athlete-dashboard/v1/profile/test",user:"athlete-dashboard/v1/profile/user",full:"athlete-dashboard/v1/profile/full",basic:"athlete-dashboard/v1/profile/basic"};t(621).U;class o extends Error{constructor(e){super(e.message),this.details=e,this.name="ProfileError"}}class a{constructor(e,r){this.currentUserData=null,this.CORE_FIELDS=["username","email","displayName","firstName","lastName"],this.EXTENDED_FIELDS=["nickname","roles"],this.apiUrl=e.replace(/\/$/,""),this.nonce=r,console.log("ProfileService initialized with:",{apiUrl:this.apiUrl,noncePresent:!!r})}async fetchProfile(e){try{console.group("ProfileService: fetchProfile"),console.log("Fetching profile for user:",e);const r=`${this.apiUrl}/athlete-dashboard/v1/profile/user`;console.log("API URL:",r),console.log("Headers:",{"X-WP-Nonce":this.nonce?"[PRESENT]":"[MISSING]"});const t=await fetch(r,{headers:{"X-WP-Nonce":this.nonce,Accept:"application/json"}});console.log("Profile fetch response status:",t.status);const n=await t.text();if(console.log("Raw response:",n),!t.ok)throw 404===t.status&&console.error("Profile endpoint not found. Please ensure the WordPress REST API route is registered."),new o({code:"NETWORK_ERROR",message:`Failed to fetch profile data: ${t.status} ${t.statusText}`,status:t.status});let a;try{a=JSON.parse(n)}catch(e){throw console.error("Error parsing response:",e),new o({code:"NETWORK_ERROR",message:"Invalid JSON response from server",status:t.status})}const s=this.normalizeProfileData(a);return console.log("Normalized profile data:",s),console.groupEnd(),s}catch(e){throw console.error("Profile fetch error:",e),console.groupEnd(),e instanceof o?e:new o({code:"NETWORK_ERROR",message:e instanceof Error?e.message:"Failed to fetch profile data"})}}async updateProfile(e,r){try{console.group("ProfileService: updateProfile"),console.log("Updating profile for user:",e),console.group("Profile Update Request"),console.log("Request Data:",{userId:e,email:r.email,emailType:typeof r.email,emailExists:"email"in r,fullData:r}),console.groupEnd();const t=`${this.apiUrl}/${n.base}`;console.log("API URL:",t),console.log("Headers:",{"Content-Type":"application/json","X-WP-Nonce":this.nonce?"[PRESENT]":"[MISSING]"});const a=this.denormalizeProfileData(r);console.log("Denormalized data for backend:",{...a,email:a.email,emailType:typeof a.email});const s=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":this.nonce,Accept:"application/json"},body:JSON.stringify(a)});console.log("Profile update response status:",s.status);const i=await s.text();if(console.log("Raw update response:",i),!s.ok)throw 404===s.status&&console.error("Profile endpoint not found. Please ensure the WordPress REST API route is registered."),new o({code:"NETWORK_ERROR",message:`Failed to update profile data: ${s.status} ${s.statusText}`,status:s.status});let l;try{l=JSON.parse(i)}catch(e){throw console.error("Error parsing response:",e),new o({code:"NETWORK_ERROR",message:"Invalid JSON response from server",status:s.status})}const d=this.normalizeProfileData(l);return console.log("Normalized updated data:",d),console.groupEnd(),d}catch(e){throw console.error("Profile update error:",e),console.groupEnd(),e instanceof o?e:new o({code:"NETWORK_ERROR",message:e instanceof Error?e.message:"Failed to update profile data"})}}normalizeProfileData(e){console.group("ProfileService: normalizeProfileData"),console.log("Raw data received:",e);const r=e.data?.profile||e.data||e;if(console.log("Extracted profile data:",r),console.log("[ProfileService] Response format:","new"),!("user_login"in r)&&!("username"in r))throw console.error("[ProfileService] Missing required fields in response"),console.groupEnd(),new o({code:"INVALID_RESPONSE",message:"Profile data is missing required fields"});console.log("Raw field values:",{username:{user_login:r.user_login,username:r.username},displayName:{display_name:r.display_name,name:r.name,displayName:r.displayName},email:{user_email:r.user_email,email:r.email}});const t={id:Number(r.id)||0,username:r.user_login||r.username||"",email:r.user_email||r.email||"",displayName:r.display_name||r.name||"",firstName:r.first_name||r.firstName||"",lastName:r.last_name||r.lastName||"",nickname:r.nickname||"",roles:Array.isArray(r.roles)?r.roles:[],phone:r.phone||"",age:Number(r.age)||0,dateOfBirth:r.date_of_birth||"",gender:r.gender||"",dominantSide:r.dominant_side||"",medicalClearance:Boolean(r.medical_clearance),medicalNotes:r.medical_notes||"",emergencyContactName:r.emergency_contact_name||"",emergencyContactPhone:r.emergency_contact_phone||"",injuries:Array.isArray(r.injuries)?r.injuries.map((e=>({id:e.id||String(Date.now()),name:e.name||"",details:e.details||"",type:e.type||"general",description:e.description||e.details||"",date:e.date||(new Date).toISOString(),severity:e.severity||"medium",isCustom:!0,status:e.status||"active"}))):[]};return console.log("Field normalization results:",{username:{raw:r.user_login,normalized:t.username},displayName:{raw:r.display_name,normalized:t.displayName},email:{raw:r.user_email,normalized:t.email}}),this.currentUserData=t,console.log("Final normalized data:",t),console.groupEnd(),t}denormalizeProfileData(e){console.group("ProfileService: denormalizeProfileData");const r=this.currentUserData?.email||"",t="email"in e,n=t?e.email?.trim()||null:r;console.log("Email preservation:",{inputEmail:e.email,inputEmailType:typeof e.email,currentEmail:r,emailExists:t,finalEmail:n,finalEmailType:typeof n,wasPreserved:!t,trimmedLength:e.email?.trim().length});const o={id:e.id,username:e.username||"",email:n,display_name:e.displayName||"",first_name:e.firstName||"",last_name:e.lastName||"",phone:e.phone,age:e.age,date_of_birth:e.dateOfBirth,gender:e.gender,dominant_side:e.dominantSide,medical_clearance:e.medicalClearance,medical_notes:e.medicalNotes,emergency_contact_name:e.emergencyContactName,emergency_contact_phone:e.emergencyContactPhone,injuries:e.injuries?.map((e=>({id:e.id,name:e.name,details:e.details,type:e.type,description:e.description,date:e.date,severity:e.severity,status:e.status})))};return Object.keys(o).forEach((e=>{void 0!==o[e]&&null!==o[e]||delete o[e]})),console.log("Denormalized data for backend:",o),console.groupEnd(),o}}},621:(e,r,t)=>{t.d(r,{U:()=>o,i:()=>n});const n={PROFILE_UPDATED:"profile_updated",PROFILE_LOADED:"profile_loaded",PROFILE_ERROR:"profile_error",PROFILE_DELETED:"profile_deleted"},o={FETCH_REQUEST:"profile:fetch-request",FETCH_SUCCESS:"profile:fetch-success",FETCH_ERROR:"profile:fetch-error",UPDATE_REQUEST:"profile:update-request",UPDATE_SUCCESS:"profile:update-success",UPDATE_ERROR:"profile:update-error",SECTION_CHANGE:"profile:section-change",VALIDATION_ERROR:"profile:validation-error",FORM_RESET:"profile:form-reset"}},379:(e,r,t)=>{t.d(r,{Rs:()=>l,vu:()=>d,Jd:()=>c});var n=t(848),o=t(609);class a{constructor(){this.baseUrl="/wp-json"}static getInstance(){return a.instance||(a.instance=new a),a.instance}getNonce(){return window.athleteDashboardData?.nonce||""}transformUserData(e){console.group("AuthService: Transform User Data"),console.log("Raw WordPress user data:",{id:e.id,user_login:e.user_login,username:e.username,user_email:e.user_email,email:e.email,display_name:e.display_name,name:e.name,first_name:e.first_name,last_name:e.last_name,roles:e.roles});const r={id:e.id,username:e.user_login||e.username||"",email:e.user_email||e.email||"",displayName:e.display_name||e.name||"",firstName:e.first_name||"",lastName:e.last_name||"",roles:e.roles||[]};return console.log("Field mapping results:",{username:{from_user_login:e.user_login,from_username:e.username,final:r.username},email:{from_user_email:e.user_email,from_email:e.email,final:r.email},displayName:{from_display_name:e.display_name,from_name:e.name,final:r.displayName},firstName:{value:r.firstName,source:e.first_name},lastName:{value:r.lastName,source:e.last_name}}),console.log("Transformed user data:",r),console.groupEnd(),r}async getCurrentUser(){try{console.group("AuthService: Get Current User");const e=`${this.baseUrl}/wp/v2/users/me?context=edit`,r=this.getNonce();console.log("Request details:",{endpoint:e,hasNonce:!!r,baseUrl:this.baseUrl});const t=await fetch(e,{headers:{"X-WP-Nonce":r}});if(console.log("Response details:",{status:t.status,statusText:t.statusText,ok:t.ok}),!t.ok){if(401===t.status)return console.log("User not authenticated"),console.groupEnd(),null;throw new Error(`Failed to fetch user data: ${t.status} ${t.statusText}`)}const n=await t.json();if(console.log("Raw API response:",n),!n?.id)throw console.error("Invalid user data received:",n),new Error("Invalid user data: missing ID");const o={id:n.id,username:n.user_login||n.username||"",email:n.user_email||n.email||"",displayName:n.display_name||n.name||"",firstName:n.first_name||"",lastName:n.last_name||"",roles:n.roles||[]};return console.log("Transformed user data:",o),console.groupEnd(),o}catch(e){throw console.error("Error in getCurrentUser:",e),console.groupEnd(),e}}async logout(){try{if(console.group("AuthService: Logout"),!(await fetch("/wp-login.php?action=logout",{method:"POST",headers:{"X-WP-Nonce":this.getNonce()}})).ok)throw new Error("Logout failed");console.log("Logout successful"),window.location.href="/wp-login.php"}catch(e){throw console.error("Error during logout:",e),e}finally{console.groupEnd()}}async checkAuthentication(){try{return!!await this.getCurrentUser()}catch(e){return console.error("Error checking authentication:",e),!1}}}var s=t(813);const i={user:null,isLoading:!0,error:null,isAuthenticated:!1,checkAuth:async()=>!1,logout:async()=>{},refreshUser:async()=>{},updateUserProfile:async e=>{throw new Error("UserContext not initialized")}},l=(0,o.createContext)(i);function d({children:e}){const[r,t]=(0,o.useState)({user:null,isLoading:!0,error:null,isAuthenticated:!1}),i=(0,o.useRef)(!1),d=(0,o.useRef)(0),c=(0,o.useCallback)((async()=>{const e=Date.now();if(i.current||e-d.current<1e3)return console.log("Skipping fetch: too soon or already in progress"),null;i.current=!0,d.current=e;try{const e=a.getInstance();return await e.getCurrentUser()}catch(e){throw console.error("Error fetching user data:",e),e}finally{i.current=!1}}),[]),u=(0,o.useCallback)((async()=>{if(r.isAuthenticated&&r.user)return console.log("Already authenticated with user data, skipping check"),!0;try{console.group("UserContext: Check Auth"),console.log("Current state:",r),r.isLoading||t((e=>({...e,isLoading:!0,error:null})));const e=await c();return console.log("Fetch user data result:",e),e?(console.log("User authenticated, updating state"),t({user:e,isLoading:!1,error:null,isAuthenticated:!0}),!0):(console.log("No user data, setting unauthenticated state"),t({user:null,isLoading:!1,error:null,isAuthenticated:!1}),!1)}catch(e){return console.error("Error checking auth:",e),t({user:null,isLoading:!1,error:e instanceof Error?e:new Error("Unknown error"),isAuthenticated:!1}),!1}finally{console.groupEnd()}}),[c,r.isAuthenticated,r.isLoading,r.user]),h=(0,o.useCallback)((async()=>{if(r.isLoading)console.log("Skipping refresh: already loading");else try{console.group("UserContext: Refresh User");const e=await c();e?(console.log("User data refreshed:",e),t((r=>({...r,user:e,error:null,isAuthenticated:!0})))):(console.log("No user data after refresh"),t((e=>({...e,user:null,error:null,isAuthenticated:!1}))))}catch(e){console.error("Error refreshing user data:",e),t((r=>({...r,error:e instanceof Error?e:new Error("Failed to refresh user data")})))}finally{console.groupEnd()}}),[c,r.isLoading]),f=(0,o.useCallback)((async()=>{if(r.isLoading)console.log("Skipping logout: already loading");else try{console.group("UserContext: Logout"),t((e=>({...e,isLoading:!0})));const e=a.getInstance();await e.logout(),t({user:null,isLoading:!1,error:null,isAuthenticated:!1})}catch(e){console.error("Error during logout:",e),t((r=>({...r,isLoading:!1,error:e instanceof Error?e:new Error("Unknown error")})))}finally{console.groupEnd()}}),[r.isLoading]),m=(0,o.useCallback)((async e=>{if(!r.user?.id)throw new Error("Cannot update profile: No user logged in");try{console.group("UserContext: Update Profile"),console.log("Current user:",r.user),console.log("Update data:",e);const n={...e,email:"email"in e?e.email?.trim()||null:r.user.email};console.log("Processed update data:",n);const o=new s.p(window.athleteDashboardData.apiUrl,window.athleteDashboardData.nonce),a=await o.updateProfile(r.user.id,n),i={...r.user,...a,roles:r.user.roles,email:a.email||r.user.email};return t((e=>({...e,user:i}))),console.log("Profile updated successfully:",i),i}catch(e){throw console.error("Error updating profile:",e),e}finally{console.groupEnd()}}),[r.user]);(0,o.useEffect)((()=>{console.log("UserContext: Initial auth check"),u().catch((e=>{console.error("Error during initial auth check:",e),t({user:null,isLoading:!1,error:e instanceof Error?e:new Error("Failed to check authentication"),isAuthenticated:!1})}))}),[u]);const p={...r,checkAuth:u,logout:f,refreshUser:h,updateUserProfile:m};return(0,n.jsx)(l.Provider,{value:p,children:e})}function c(){const e=(0,o.useContext)(l);if(!e)throw new Error("useUser must be used within a UserProvider");return e}},609:e=>{e.exports=window.React},87:e=>{e.exports=window.wp.element},723:e=>{e.exports=window.wp.i18n}},n={};function o(e){var r=n[e];if(void 0!==r)return r.exports;var a=n[e]={exports:{}};return t[e](a,a.exports,o),a.exports}o.m=t,o.n=e=>{var r=e&&e.__esModule?()=>e.default:()=>e;return o.d(r,{a:r}),r},o.d=(e,r)=>{for(var t in r)o.o(r,t)&&!o.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:r[t]})},o.f={},o.e=e=>Promise.all(Object.keys(o.f).reduce(((r,t)=>(o.f[t](e,r),r)),[])),o.u=e=>e+"."+{19:"474a4475a74288b59864",166:"ec463c940a870a3a56b7",299:"c2881b045d05b488815b",356:"f1e431e41222b1267c2a",614:"981d0ac17cb83c4bf0d9"}[e]+".js",o.miniCssF=e=>e+".css",o.miniCssF=e=>"app."+{19:"07856f572ba26f83fc34",166:"eecd24fbfd827ee92f67",299:"3b1eb5f0dd1f68900ffe"}[e]+".css",o.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r),e={},r="athlete-dashboard-child:",o.l=(t,n,a,s)=>{if(e[t])e[t].push(n);else{var i,l;if(void 0!==a)for(var d=document.getElementsByTagName("script"),c=0;c<d.length;c++){var u=d[c];if(u.getAttribute("src")==t||u.getAttribute("data-webpack")==r+a){i=u;break}}i||(l=!0,(i=document.createElement("script")).charset="utf-8",i.timeout=120,o.nc&&i.setAttribute("nonce",o.nc),i.setAttribute("data-webpack",r+a),i.src=t),e[t]=[n];var h=(r,n)=>{i.onerror=i.onload=null,clearTimeout(f);var o=e[t];if(delete e[t],i.parentNode&&i.parentNode.removeChild(i),o&&o.forEach((e=>e(n))),r)return r(n)},f=setTimeout(h.bind(null,void 0,{type:"timeout",target:i}),12e4);i.onerror=h.bind(null,i.onerror),i.onload=h.bind(null,i.onload),l&&document.head.appendChild(i)}},o.p="/wp-content/themes/athlete-dashboard-child/assets/build/",(()=>{if("undefined"!=typeof document){var e={524:0};o.f.miniCss=(r,t)=>{e[r]?t.push(e[r]):0!==e[r]&&{19:1,166:1,299:1}[r]&&t.push(e[r]=(e=>new Promise(((r,t)=>{var n=o.miniCssF(e),a=o.p+n;if(((e,r)=>{for(var t=document.getElementsByTagName("link"),n=0;n<t.length;n++){var o=(s=t[n]).getAttribute("data-href")||s.getAttribute("href");if("stylesheet"===s.rel&&(o===e||o===r))return s}var a=document.getElementsByTagName("style");for(n=0;n<a.length;n++){var s;if((o=(s=a[n]).getAttribute("data-href"))===e||o===r)return s}})(n,a))return r();((e,r,t,n,a)=>{var s=document.createElement("link");s.rel="stylesheet",s.type="text/css",o.nc&&(s.nonce=o.nc),s.onerror=s.onload=t=>{if(s.onerror=s.onload=null,"load"===t.type)n();else{var o=t&&t.type,i=t&&t.target&&t.target.href||r,l=new Error("Loading CSS chunk "+e+" failed.\n("+o+": "+i+")");l.name="ChunkLoadError",l.code="CSS_CHUNK_LOAD_FAILED",l.type=o,l.request=i,s.parentNode&&s.parentNode.removeChild(s),a(l)}},s.href=r,document.head.appendChild(s)})(e,a,0,r,t)})))(r).then((()=>{e[r]=0}),(t=>{throw delete e[r],t})))}}})(),(()=>{if("undefined"!=typeof document){var e={524:0};o.f.miniCss=(r,t)=>{e[r]?t.push(e[r]):0!==e[r]&&{19:1,166:1,299:1}[r]&&t.push(e[r]=(e=>new Promise(((r,t)=>{var n=o.miniCssF(e),a=o.p+n;if(((e,r)=>{for(var t=document.getElementsByTagName("link"),n=0;n<t.length;n++){var o=(s=t[n]).getAttribute("data-href")||s.getAttribute("href");if("stylesheet"===s.rel&&(o===e||o===r))return s}var a=document.getElementsByTagName("style");for(n=0;n<a.length;n++){var s;if((o=(s=a[n]).getAttribute("data-href"))===e||o===r)return s}})(n,a))return r();((e,r,t,n,a)=>{var s=document.createElement("link");s.rel="stylesheet",s.type="text/css",o.nc&&(s.nonce=o.nc),s.onerror=s.onload=t=>{if(s.onerror=s.onload=null,"load"===t.type)n();else{var o=t&&t.type,i=t&&t.target&&t.target.href||r,l=new Error("Loading CSS chunk "+e+" failed.\n("+o+": "+i+")");l.name="ChunkLoadError",l.code="CSS_CHUNK_LOAD_FAILED",l.type=o,l.request=i,s.parentNode&&s.parentNode.removeChild(s),a(l)}},s.href=r,document.head.appendChild(s)})(e,a,0,r,t)})))(r).then((()=>{e[r]=0}),(t=>{throw delete e[r],t})))}}})(),(()=>{var e={524:0};o.f.j=(r,t)=>{var n=o.o(e,r)?e[r]:void 0;if(0!==n)if(n)t.push(n[2]);else{var a=new Promise(((t,o)=>n=e[r]=[t,o]));t.push(n[2]=a);var s=o.p+o.u(r),i=new Error;o.l(s,(t=>{if(o.o(e,r)&&(0!==(n=e[r])&&(e[r]=void 0),n)){var a=t&&("load"===t.type?"missing":t.type),s=t&&t.target&&t.target.src;i.message="Loading chunk "+r+" failed.\n("+a+": "+s+")",i.name="ChunkLoadError",i.type=a,i.request=s,n[1](i)}}),"chunk-"+r,r)}};var r=(r,t)=>{var n,a,[s,i,l]=t,d=0;if(s.some((r=>0!==e[r]))){for(n in i)o.o(i,n)&&(o.m[n]=i[n]);l&&l(o)}for(r&&r(t);d<s.length;d++)a=s[d],o.o(e,a)&&e[a]&&e[a][0](),e[a]=0},t=globalThis.webpackChunkathlete_dashboard_child=globalThis.webpackChunkathlete_dashboard_child||[];t.forEach(r.bind(null,0)),t.push=r.bind(null,t.push.bind(t))})(),o.nc=void 0,(()=>{var e=o(87),r=o(7);class t extends r.EventEmitter{emit(e,r){return super.emit(e,r)}on(e,r){return super.on(e,r)}off(e,r){return super.off(e,r)}removeAllListeners(e){return super.removeAllListeners(e)}removeListener(e,r){return super.removeListener(e,r)}}const n=new t;class a{constructor(e){this.features=new Map,this.initialized=new Set,this.context=e,this.setupGlobalEvents()}setupGlobalEvents(){n.on("user:changed",(e=>{this.features.forEach((r=>{r.onUserChange&&r.onUserChange(e)}))})),n.on("navigation:changed",(e=>{this.features.forEach((e=>{e.onNavigate&&e.onNavigate()}))}))}async register(e){if(this.features.has(e.identifier))throw new Error(`Feature ${e.identifier} is already registered`);try{this.features.set(e.identifier,e),e.isEnabled()&&await this.initFeature(e),n.emit("feature.registered",{identifier:e.identifier,metadata:e.metadata}),this.context.debug&&console.log(`Registered feature: ${e.identifier}`,{metadata:e.metadata,enabled:e.isEnabled()})}catch(r){throw n.emit("feature.error",{identifier:e.identifier,error:r}),r}}async initFeature(e){if(!this.initialized.has(e.identifier))try{await e.register(this.context),await e.init(),this.initialized.add(e.identifier),n.emit("feature.initialized",{identifier:e.identifier}),this.context.debug&&console.log(`Initialized feature: ${e.identifier}`)}catch(r){throw n.emit("feature.error",{identifier:e.identifier,error:r}),r}}getFeature(e){return this.features.get(e)}getAllFeatures(){return Array.from(this.features.values())}getEnabledFeatures(){return this.getAllFeatures().filter((e=>e.isEnabled()))}isFeatureInitialized(e){return this.initialized.has(e)}async cleanup(){for(const e of this.features.values())this.initialized.has(e.identifier)&&await e.cleanup();this.features.clear(),this.initialized.clear(),n.removeAllListeners()}}var s=o(848),i=o(609),l=o(379);const d=({features:e,currentFeature:r})=>(0,s.jsxs)("nav",{className:"dashboard-nav",children:[(0,s.jsx)("div",{className:"nav-header",children:(0,s.jsx)("h2",{children:"Dashboard"})}),(0,s.jsx)("ul",{className:"nav-list",children:e.sort(((e,r)=>"overview"===e.identifier?-1:"overview"===r.identifier?1:(e.metadata.order||0)-(r.metadata.order||0))).map((e=>{const t=e.identifier===r;return window.athleteDashboardData.debug&&console.log("[Navigation] Rendering feature:",{id:e.identifier,active:t,metadata:e.metadata}),(0,s.jsx)("li",{className:"nav-item",children:(0,s.jsxs)("button",{className:"nav-button "+(t?"active":""),onClick:()=>(e=>{window.athleteDashboardData.debug&&console.log("[Navigation] Navigating to feature:",{from:r,to:e.identifier,metadata:e.metadata}),n.emit("navigation:changed",{identifier:e.identifier});const t=new URL(window.location.href);t.searchParams.set("dashboard_feature",e.identifier),window.history.pushState({},"",t.toString())})(e),"aria-current":t?"page":void 0,children:[(0,s.jsx)("span",{className:"nav-label",children:e.metadata.name}),e.metadata.description&&(0,s.jsx)("span",{className:"nav-description",children:e.metadata.description})]})},e.identifier)}))})]});var c=o(57);const u=({feature:e,context:r,fallbackFeature:t})=>{const[n,o]=(0,i.useState)(e||t);return(0,i.useEffect)((()=>{r.debug&&console.log("[FeatureRouter] Feature changed:",{feature:e?.identifier,fallback:t?.identifier}),o(e||t)}),[e,t,r.debug]),n?n.isEnabled()?(r.debug&&console.log("[FeatureRouter] Rendering feature:",n.identifier),(0,s.jsx)(c.t,{fallback:(0,s.jsxs)("div",{className:"feature-error",children:[(0,s.jsx)("h3",{children:"Rendering Error"}),(0,s.jsx)("p",{children:"An error occurred while rendering the feature."})]}),children:(0,s.jsx)("div",{className:"feature-container",children:n.render({userId:r.userId})})})):(console.error("[FeatureRouter] Feature is disabled:",n.identifier),(0,s.jsxs)("div",{className:"feature-error",children:[(0,s.jsx)("h3",{children:"Feature Disabled"}),(0,s.jsx)("p",{children:"This feature is currently disabled."})]})):(console.error("[FeatureRouter] No feature available"),(0,s.jsxs)("div",{className:"feature-error",children:[(0,s.jsx)("h3",{children:"Feature Not Available"}),(0,s.jsx)("p",{children:"The requested feature could not be found."})]}))},h="overview",f=({registry:e,context:r})=>{const{user:t,isLoading:o,error:a}=(e=>{e.debug&&console.log("[useUser] Accessing user context");const r=(0,i.useContext)(l.Rs);if(!r)throw new Error("useUser must be used within a UserProvider");return e.debug&&console.log("[useUser] Current state:",{hasUser:!!r.user,isLoading:r.isLoading,hasError:!!r.error,isAuthenticated:r.isAuthenticated}),{user:r.user?{id:r.user.id,name:r.user.displayName,email:r.user.email,roles:r.user.roles}:null,isLoading:r.isLoading,error:r.error?.message||null}})(r),[c,f]=(0,i.useState)(h);if((0,i.useEffect)((()=>{if(!function(e){if(!e||"object"!=typeof e)return console.error("Dashboard data is not an object"),!1;const r=["apiUrl","nonce","userId"].filter((r=>!(r in e)));return r.length>0?(console.error("Missing required dashboard data fields:",r),!1):!e.feature||"object"!=typeof e.feature||"string"==typeof e.feature.name&&"string"==typeof e.feature.label||(console.error("Invalid feature data structure"),!1)}(window.athleteDashboardData))return void console.error("[DashboardShell] Invalid dashboard data structure");const o=new URLSearchParams(window.location.search).get("dashboard_feature");o&&e.getFeature(o)&&f(o),r.debug&&console.log("[DashboardShell] Mounted with:",{featureFromUrl:o,activeFeature:c,registeredFeatures:e.getAllFeatures().map((e=>e.identifier)),user:t?.id});const a=({identifier:e})=>{r.debug&&console.log("[DashboardShell] Navigation change:",e),f(e)};return n.on("navigation:changed",a),()=>{n.off("navigation:changed",a)}}),[e,t,r.debug,c]),o)return console.log("[DashboardShell] Loading user data..."),(0,s.jsx)("div",{className:"dashboard-shell",children:(0,s.jsxs)("div",{className:"dashboard-loading",children:[(0,s.jsx)("div",{className:"loading-spinner"}),(0,s.jsx)("p",{children:"Loading dashboard..."})]})});if(a||!t)return console.error("[DashboardShell] User error:",a),(0,s.jsx)("div",{className:"dashboard-shell",children:(0,s.jsxs)("div",{className:"dashboard-error",children:[(0,s.jsx)("h3",{children:"Dashboard Error"}),(0,s.jsx)("p",{children:a||"Failed to load user data"}),(0,s.jsx)("button",{onClick:()=>window.location.reload(),className:"retry-button",children:"Retry"})]})});const m=e.getFeature(c),p=c!==h?e.getFeature(h):void 0,g=e.getEnabledFeatures();return r.debug&&console.log("[DashboardShell] Rendering with:",{activeFeature:c,currentFeature:m?.identifier,fallbackFeature:p?.identifier,enabledFeatures:g.map((e=>e.identifier))}),0===g.length?(console.error("[DashboardShell] No enabled features available"),(0,s.jsx)("div",{className:"dashboard-shell",children:(0,s.jsxs)("div",{className:"dashboard-error",children:[(0,s.jsx)("h3",{children:"No Features Available"}),(0,s.jsx)("p",{children:"No dashboard features are currently enabled."})]})})):(0,s.jsxs)("div",{className:"dashboard-shell",children:[(0,s.jsx)(d,{features:g,currentFeature:c}),(0,s.jsx)("main",{className:"dashboard-content",children:(0,s.jsx)(u,{feature:m,fallbackFeature:p,context:r})})]})},m=({registry:e,context:r})=>(0,s.jsx)(l.vu,{children:(0,s.jsx)(f,{registry:e,context:r})});document.addEventListener("DOMContentLoaded",(async function(){const r={apiUrl:window.athleteDashboardData.apiUrl,nonce:window.athleteDashboardData.nonce,debug:window.athleteDashboardData.debug,userId:window.athleteDashboardData.userId,dispatch:e=>r=>{console.log(`Dispatching action to ${e}:`,r)}};try{console.log("[Dashboard] Initializing with context:",r),console.log("[Dashboard] Current feature:",window.athleteDashboardData.feature);const t=new a(r),{OverviewFeature:n}=await o.e(299).then(o.bind(o,299)),{ProfileFeature:s}=await o.e(166).then(o.bind(o,166)),{WorkoutGeneratorFeature:i}=await Promise.all([o.e(356),o.e(19)]).then(o.bind(o,19)),{EquipmentManagerFeature:l}=await o.e(614).then(o.bind(o,614));await t.register(new n),await t.register(new s),await t.register(new i),await t.register(new l),console.log("[Dashboard] Registered features:",t.getAllFeatures().map((e=>({id:e.identifier,enabled:e.isEnabled(),metadata:e.metadata})))),r.debug&&console.log("[Dashboard] Feature registration complete");const d=document.getElementById("athlete-dashboard");if(!d)throw new Error("Dashboard container not found");const c=(0,e.createElement)(m,{registry:t,context:r});window.wp.element.render(c,d)}catch(e){console.error("[Dashboard] Failed to initialize:",e);const r=document.getElementById("athlete-dashboard");r&&(r.innerHTML=`\n                <div class="dashboard-error">\n                    <h3>Dashboard Error</h3>\n                    <p>Failed to initialize the dashboard. Please try refreshing the page.</p>\n                    <pre>${e instanceof Error?e.message:"Unknown error"}</pre>\n                </div>\n            `)}}))})()})();